# Conserved_Stromatolite_bacteria_manuscript
A collection of raw data, Python script and R scripts used to create data and images for manuscript entitled "Conserved bacterial genomes from two geographically distinct peritidal stromatolite formations shed light on potential functional guilds"

Figure 1:
1. ORFs were called in all genomes using prokka 1.14.5.
2. ORFs were assigned KO annotations using kofamscan 1.0.0
3. KO annotations for each bin were parsed using kegg_parser.py to obtained contig-coverage-corrected gene abundances of all KO entries listed in query files. Query files used in this study were created manually using a combination of literature and KEGG searches.
4. Conserved genomes were filtered out and used for Fig.1 
5. Abundance of geneX was calculated as relative to the total abundnace of that gene in the given sample.
    Please see Fig1_Fig5_data.xlsx for clarification
6. Phylogenetic tree was created using JolyTree (Criscuolo, 2019) with a sketch size of 10 000.
7. Both the tree and the abundance data were uploaded to iTol and visualized using the heatmap option.

Figure S2.
Amplicon library datasets were processed and curated using the Mothur software platform (Schloss et al., 2009). 
1.Sequences shorter than 200 nucleotides or containing ambiguous bases or homopolymeric runs greater than 7 were discarded. 
2. Sequences were classified using Naive-Bayesian classifier against the Silva database (v132)
3. Vsearch software (Rognes et al., 2016) was used to remove chimeras. 
4. Reads that were 97% similar were combined into operational taxonomic units (OTUs) using the Opticlust method (Westcott and Schloss, 2017). 

Figure S3:
1. ORFs were called in Bacteria.filtered.fasta files (generated by Automneta) for all samples (CSU, SU, SM1, SM2, SL, CRU, RU, RM1, RM2, RL) using prodigal v2.6.3.
2. ORFs were assigned KO annotations using kofamscan 1.0.0
3. Contig-coverage weighted KO-annotated gene abundance for each sample was counted using kegg.parser.py
4. Sample coverage was calculated using weighted_contig_coverage_calculator.py
5. The sum of all genes (contig coverage corrected) was calculated using cov_correct_all_genes.py
6. Relative total abundance of each annoated gene was calculated as
    Relative abudance of geneX = geneX abundance/Sample coverage/sum of all genes*100
    Please see FigS3_data.xlsx for clarification.
7. KO abundance was visualized with a heatmap created in R, using code found in "R_code_for_heatmaps" in this repo.

Figure S4:
Panel A:
1. Genome coverage was used as a proxy for abundance. 
2. Relative abundance was calculated as genome coverage/sum of all sample genome coverages*100
3. Relative abundance was plotted using Microsoft Excel.
4. Conserved genomes were defined as sharing >97% ANI (See Table S1)
5. Colours of bars were changed using Adobe illustrator.

Panel B:
1. The same data was used as in Panel A, but only the abundance of conserved genomes were shown.
2. Genomes were taxonomically classified using the standalone GTDB-Tk tool (version 0.3.2).
3. Genome Taxonomy Database version 89 (Parks et al., 2019) was used as a reference for classification. Equivalent NCBI taxonomic classifications have been provided for clarity in Table S2.
4. Colours of bars were changed using Adobe illustrator in accordance with the taxonomic classification of each bin.

Figure S5:
1. ORFs were called in all genomes using prokka 1.14.5.
2. ORFs were assigned KO annotations using kofamscan 1.0.0
3. KO annotations for each bin were parsed using kegg_parser.py to obtained contig-coverage-corrected gene abundances of all KO entries listed in query files. Query files used in this study were created manually using a combination of literature and KEGG searches.
4. Abundance of geneX was calculated as relative to the total abundnace of that gene in the given sample.
    Please see Fig1_Fig5_data.xlsx for clarification
5. Phylogenetic tree was created using JolyTree (Criscuolo, 2019) with a sketch size of 10 000.
6. Both the tree and the abundance data were uploaded to iTol and visualized using the heatmap option.
